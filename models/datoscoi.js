var Firebird = require('node-firebird');
var moment = require('moment');
var options = {};
/*==========================================*/
// Opciones para conectarse a la BD
/*==========================================*/
options.host = '127.0.0.1';
options.port = 3050;

options.database = 'C:\\COI80EMPRE6.FDB';

//options.database = 'D:\\COI80EMPRE6.FDB';
options.user = 'SYSDBA';
options.password = 'masterkey';
options.lowercase_keys = false; // set to true to lowercase keys
options.role = null;            // default
options.pageSize = 4096;        // default when creating databaSE

var datosCOI = {};

datosCOI.getDepartamentos = function(){
   return new Promise((resolve,reject) => {
		
        Firebird.attach(options, function(err, db) {
          if (err)
                reject(err)
            // db = DATABASE
            db.query('SELECT * FROM DEPTOS', function(err, result) { 
                if(err)
                    reject(err);
                console.log(JSON.stringify(result));
                // IMPORTANT: close the connection
                db.detach();
                resolve(result);
            });         
        });
    });

	
}
//Obtener datos de las cuentas por departamentos
datosCOI.getDatosCuentasXDpto = function(mes,anhio){
	  return new Promise((resolve,reject) => {
		
        Firebird.attach(options, function(err, db) {
          if (err){
                reject(err);
				console.log(err);
		  }	
		  console.log("1- "+mes+" 2- "+anhio);
		  var ch = 'S';
			var sel = 'SELECT T1.NUM_CTA AS NUMCUENTA,T1.NOMBRE AS NAMECUENTA,T1.DEPTSINO,T1.TIPO,T3.DESCRIP AS NAMEDPTO,T2.EJERCICIO,T2.DEPTO,';
			var saldo_inicial='';
			var total_cargos='';
			var total_abonos='';
			var saldo_final = '';
			var from_where = " FROM CUENTAS19 AS T1 INNER JOIN SALDOSDP19 AS T2 ON T1.NUM_CTA = T2.NUM_CTA INNER JOIN DEPTOS AS T3 ON T2.DEPTO = T3.DEPTO WHERE T1.DEPTSINO = 'S' ORDER BY T2.DEPTO,T1.NUM_CTA ASC";
			//
			var sql ='';
			switch(mes){
				case 0:
					saldo_inicial = 'T2.INICIAL AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO01 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO01 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01-T2.ABONO01) AS SALDOFINAL';
					break;
				case 1:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01-T2.ABONO01) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO02 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO02 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02-T2.ABONO01-T2.ABONO02) AS SALDOFINAL';
					break;
				case 2:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02-T2.ABONO01-T2.ABONO02) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO03 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO03 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03-T2.ABONO01-T2.ABONO02-T2.ABONO03) AS SALDOFINAL';
					break;
				case 3:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03-T2.ABONO01-T2.ABONO02-T2.ABONO03) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO04 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO04 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04) AS SALDOFINAL';
					break;
				case 4:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO05 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO05 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05) AS SALDOFINAL';
					break;
				case 5:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO06 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO06 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06) AS SALDOFINAL';
					break;
				case 6:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO07 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO07 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07) AS SALDOFINAL';
					break;
				case 7:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO08 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO08 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08) AS SALDOFINAL';
					break;
				case 8:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO09 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO09 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09) AS SALDOFINAL';
					break;
				case 9:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO10 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO10 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10) AS SALDOFINAL';
					break;
				case 10:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO11 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO11 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10+T2.CARGO11-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10-T2.ABONO11) AS SALDOFINAL';
					break;
				case 11:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10+T2.CARGO11-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10-T2.ABONO11) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO12 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO12 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10+T2.CARGO11+T2.CARGO12-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10-T2.ABONO11-T2.ABONO12) AS SALDOFINAL';
					break;		
			}
			sql = sel+saldo_inicial+total_cargos+total_abonos+saldo_final+from_where;
			console.log("1- "+mes+" 2- "+anhio+" sql- "+sql);
            // db = DATABASE
			   db.query(sql, function(err, result) { 
					if(err){
						reject(err);
						console.log(err);
					}	
					//console.log(JSON.stringify(result));
					// IMPORTANT: close the connection
					db.detach();
					resolve(result);
					
				}); 
				
        });
    });
}
//Obtener datos de todas las cuentas 
datosCOI.getDatosCuentas = function(mes,anhio){
	//console.log("1- "+ mes+ "2- " +anhio);
	  return new Promise((resolve,reject) => {
		
        Firebird.attach(options, function(err, db) {
          if (err){
                reject(err);
				console.log(err);
		  }	
            // db = DATABASE
			var sel = 'SELECT T1.NUM_CTA AS NUMCUENTA,T1.NOMBRE AS NAMECUENTA,T1.DEPTSINO,T2.EJERCICIO,T1.TIPO,';
			var saldo_inicial='';
			var total_cargos='';
			var total_abonos='';
			var saldo_final = '';
			var from_where = '  FROM CUENTAS19 AS T1 INNER JOIN SALDOS19 AS T2 ON T1.NUM_CTA = T2.NUM_CTA ORDER BY NUMCUENTA ASC';
			var sql ='';
			switch(mes){
				case 0:
					saldo_inicial = 'T2.INICIAL AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO01 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO01 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01-T2.ABONO01) AS SALDOFINAL';
					break;
				case 1:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01-T2.ABONO01) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO02 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO02 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02-T2.ABONO01-T2.ABONO02) AS SALDOFINAL';
					break;
				case 2:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02-T2.ABONO01-T2.ABONO02) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO03 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO03 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03-T2.ABONO01-T2.ABONO02-T2.ABONO03) AS SALDOFINAL';
					break;
				case 3:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03-T2.ABONO01-T2.ABONO02-T2.ABONO03) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO04 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO04 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04) AS SALDOFINAL';
					break;
				case 4:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO05 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO05 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05) AS SALDOFINAL';
					break;
				case 5:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO06 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO06 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06) AS SALDOFINAL';
					break;
				case 6:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO07 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO07 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07) AS SALDOFINAL';
					break;
				case 7:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO08 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO08 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08) AS SALDOFINAL';
					break;
				case 8:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO09 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO09 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09) AS SALDOFINAL';
					break;
				case 9:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO10 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO10 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10) AS SALDOFINAL';
					break;
				case 10:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO11 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO11 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10+T2.CARGO11-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10-T2.ABONO11) AS SALDOFINAL';
					break;
				case 11:
					saldo_inicial = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10+T2.CARGO11-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10-T2.ABONO11) AS SALDOINICIAL,';
					total_cargos = 'T2.CARGO12 AS TOTALCARGOS,';
					total_abonos = 'T2.ABONO12 AS TOTALABONOS,';
					saldo_final = '(T2.INICIAL+T2.CARGO01+T2.CARGO02+T2.CARGO03+T2.CARGO04+T2.CARGO05+T2.CARGO06+T2.CARGO07+T2.CARGO08+T2.CARGO09+T2.CARGO10+T2.CARGO11+T2.CARGO12-T2.ABONO01-T2.ABONO02-T2.ABONO03-T2.ABONO04-T2.ABONO05-T2.ABONO06-T2.ABONO07-T2.ABONO08-T2.ABONO09-T2.ABONO10-T2.ABONO11-T2.ABONO12) AS SALDOFINAL';
					break;		
			}
			sql = sel+saldo_inicial+total_cargos+total_abonos+saldo_final+from_where;
			//console.log(sql);
			   db.query(sql, function(err, result) { 
					if(err){
						reject(err);
						console.log(err);
					}	
					//console.log(JSON.stringify(result));
					// IMPORTANT: close the connection
					db.detach();
					resolve(result);
					
				}); 
				
        });
    });

}

module.exports = datosCOI;